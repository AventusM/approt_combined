version: '3.8'

services:
  app:
    build:
      context: ./client
      dockerfile: dev.Dockerfile
    network_mode: "host"
    restart: on-failure:5 # "Cold" init might fail due to adb server ack not being fast enough or needing to accept usb debugging within the simulator itself.
    command: >
      sh -c "adb -s emulator-5554 wait-for-any-device &&
             npm run android"
    #ports:
    #  - 19000:19000
    #  - 19001:19001
    #  - 19002:19002
    #  - 5037:5037
    #  - 5555:5555
    volumes:
      - ./client:/usr/src/app
    env_file:
      - ./client/.env

  server:
    build:
      context: ./server
      dockerfile: dev.Dockerfile
    command: npm run dev # Override the command within Dockerfile
    network_mode: "host"
    #ports: 
    #  - 3001:3001
    volumes:
      - ./server:/usr/src/app
    env_file:
      - ./server/.env
    depends_on:
      - app

  #nginx:
  #  container_name: reverse-proxy
  #  image: nginx:1.20.1
  #  volumes:
  #    - ./nginx.conf:/etc/nginx/nginx.conf:ro
  #  ports:
  #    - 8080:80
  #  depends_on:
  #   - app

  #debug-helper:    
  #  image: busybox